"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var React=require("react"),InjectionToken=function(){function e(e){void 0===e&&(e=""),this.key=new String(e)}return e.prototype.toString=function(){return"InjectionToken("+this.key+")"},e}(),ScopeToken=function(){function e(e){void 0===e&&(e=""),this.key=new String(e)}return e.prototype.toString=function(){return"ScopeToken("+this.key+")"},e}(),DEFAULT_SCOPE=new ScopeToken("DEFAULT_SCOPE"),PARENT_SCOPE_KEY=new InjectionToken("PARENT_SCOPE"),DependencyMap=function(){function e(){this._wm=new WeakMap}return e.prototype.get=function(e){return this._wm.get(e)},e.prototype.has=function(e){return this._wm.has(e)},e.prototype.set=function(e,n){return this._wm.set(e,n),this},e}(),mappings=new WeakMap,InjectionContext=React.createContext(DEFAULT_SCOPE);function useInject(e,n){var t=React.useContext(InjectionContext),o=n||t;return React.useMemo(function(){return inject(e,o)},[e,o])}function inject(e,n){void 0===n&&(n=DEFAULT_SCOPE);var t=mappings.get(n);if(!t)throw new Error("The given scope is not defined");if(t.has(e))return t.get(e);if(t.has(PARENT_SCOPE_KEY))return inject(e,t.get(PARENT_SCOPE_KEY));throw new Error("Injectables have to be provided in a module.")}function isSingleProvider(e){return!("initValue"in e||"initFactory"in e||"initClass"in e)}function preprocessProvider(e){return isSingleProvider(e)?{initClass:e,provider:e}:e}function DefineModule(e,n,t){void 0===n&&(n=DEFAULT_SCOPE);var o=n instanceof ScopeToken?n:new ScopeToken(n);mappings.has(o)||mappings.set(o,new DependencyMap);var i=mappings.get(o);if(!i)throw new Error("Something went wrong - Dependency map couldn't be generated");if(t){if(i.has(PARENT_SCOPE_KEY))throw new Error("Parent scope can't be redefined");i.set(PARENT_SCOPE_KEY,t)}for(var r=0,c=e;r<c.length;r++){var s=preprocessProvider(c[r]),a=s.provider;"initClass"in s?i.set(a,new s.initClass(o)):"initValue"in s?i.set(a,s.initValue):"initFactory"in s&&i.set(a,s.initFactory(o))}return o}function GenerateTestBed(e,n,t){void 0===n&&(n=DEFAULT_SCOPE);var o=n instanceof ScopeToken?n:new ScopeToken(n);return mappings.set(o,new DependencyMap),DefineModule(e,o,t)}var Provider=function(e){var n=e.children,t=e.parentScope,o=e.providers,i=e.scope,r=e.test,c=React.useContext(InjectionContext),s=t||(r?void 0:c),a=i||(r?void 0:new ScopeToken("CONTEXT_SCOPE")),p=r?GenerateTestBed(o,a,s):DefineModule(o,a,s);return React.createElement(InjectionContext.Provider,{value:p},React.Children.only(n))};exports.DefineModule=DefineModule,exports.GenerateTestBed=GenerateTestBed,exports.InjectionProvider=Provider,exports.InjectionToken=InjectionToken,exports.inject=inject,exports.useInject=useInject;
